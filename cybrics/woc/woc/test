(?=^([ %()*+\-.\/]+|\d+|M_PI|M_E|log|rand|sqrt|a?(sin|cos|tan)h?)+$)
^
([^()]*|
    ([^()]*\
        ((?>[^()]+|(?4))*\)
    [^()]*)
*)$